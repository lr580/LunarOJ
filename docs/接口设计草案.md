> 系草稿，随时可能更改。

RESTful 风格：

- 统一 `/api` 前缀，让 Nginx 在前后端同域部署时分清前后端
- 资源型操作用标准 REST 动词（GET/POST/PUT/DELETE），动作型操作用 POST + 动词路径（如 `/join`、`/rejudge`），资源路径是名词复数
- 用户面向的资源用 `displayId` / `username` 访问，内部管理用雪花 ID，和你数据库的双 ID 设计对齐
- `/api/admin` 和 `/api/polygon` 做前缀隔离，权限控制清晰
- 提交代码挂在题库/比赛下，查看提交详情用全局 ID，匹配你 `submission` 表的 `problem_set_id` / `contest_id` 设计
- 讨论回复拍平到 `/discussions/{id}` 避免三层嵌套，和你数据库里二级回复的设计一致

## 认证

```
POST   /api/auth/register          # 注册
POST   /api/auth/login             # 登录，返回 JWT
POST   /api/auth/logout            # 登出，服务端失效 token
POST   /api/auth/refresh           # 刷新 access token
GET    /api/auth/captcha           # 获取图形验证码
POST   /api/auth/password/reset-request   # 忘记密码，提交重置申请（通知管理员）
```

认证相关统一用 POST（含敏感信息不走 query string），captcha 是幂等获取资源用 GET。`password/reset-request` 对应你核心功能里的"找回账号请求"，走通知表而非自助重置。

## 用户

```
GET    /api/users/me                # 当前用户信息
PUT    /api/users/me                # 修改个人信息（昵称、主页、默认代码公开等）
PUT    /api/users/me/password       # 修改密码
PUT    /api/users/me/email          # 修改邮箱
GET    /api/users/me/submissions    # 我的提交记录（跨题库）
GET    /api/users/me/solved         # 我的过题列表
GET    /api/users/me/unsolved       # 我的未过题列表
GET    /api/users/me/notifications  # 我的通知列表
PUT    /api/users/me/notifications/{id}/read   # 标记通知已读
PUT    /api/users/me/notifications/read-all    # 全部已读

GET    /api/users/{username}        # 查看用户公开主页
GET    /api/users/{username}/solved # 查看用户过题列表
```

用 `/me` 而不是 `/users/{id}` 操作自己，语义更清晰且避免越权。公开主页用 username 作为路径参数，和你设计的"URL 使用用户名索引"一致。通知的已读是局部更新用 PUT。

## 题目

```
GET    /api/problems                # 公共题库题目列表（分页、标签筛选、搜索）
GET    /api/problems/{displayId}    # 题目详情（公共题库用 displayId）
GET    /api/problems/{displayId}/solution    # 题解
GET    /api/problems/{displayId}/discussions # 题目讨论列表
POST   /api/problems/{displayId}/discussions # 发起讨论
GET    /api/discussions/{id}/replies         # 讨论的回复列表
POST   /api/discussions/{id}/replies         # 回复讨论
DELETE /api/discussions/{id}                  # 删除讨论/回复（作者或管理员）
```

公共题库的题目用 `displayId` 访问，和你数据库设计里 `problem.display_id` 对应。讨论的回复单独用 `/discussions/{id}` 作为资源根，避免 URL 嵌套过深。

## 标签

```
GET    /api/tags                    # 标签列表（含分类）
GET    /api/tag-categories          # 标签分类列表
```

只读接口，管理端负责 CRUD。前端筛选题目时需要拉取标签树。

## 题库

```
GET    /api/problem-sets                          # 可见题库列表
GET    /api/problem-sets/{id}                     # 题库详情
GET    /api/problem-sets/{id}/problems            # 题库题目列表
GET    /api/problem-sets/{id}/problems/{displayId}  # 题库内题目详情（用题库内 displayId）
POST   /api/problem-sets/{id}/problems/{displayId}/submit  # 向题库提交代码
GET    /api/problem-sets/{id}/submissions         # 题库提交记录列表
GET    /api/submissions/{id}                      # 提交详情（含代码、测试点结果）
```

提交代码挂在题库下，因为你的设计里提交记录是题库级别隔离的（`submission.problem_set_id`）。提交详情用全局 submission id 访问，因为查看详情时不需要题库上下文。

## 比赛

```
GET    /api/contests                              # 可见比赛列表
GET    /api/contests/{displayId}                  # 比赛详情（用 team 内 displayId）
POST   /api/contests/{displayId}/join             # 报名/加入比赛
POST   /api/contests/{displayId}/sign-out         # 签退
GET    /api/contests/{displayId}/problems         # 比赛题目列表
GET    /api/contests/{displayId}/problems/{problemDisplayId}  # 比赛内题目
POST   /api/contests/{displayId}/problems/{problemDisplayId}/submit  # 赛时提交
GET    /api/contests/{displayId}/submissions      # 比赛提交记录
GET    /api/contests/{displayId}/rank             # 比赛排行榜
GET    /api/contests/{displayId}/announcements    # 比赛公告列表
GET    /api/contests/{displayId}/clarifications   # 答疑列表（参赛者视角）
POST   /api/contests/{displayId}/clarifications   # 提交答疑
POST   /api/contests/{displayId}/print            # 提交打印请求
```

比赛用 `displayId` 访问，和你设计的"URL 使用比赛显示 ID + 题目显示 ID"一致。`join` 和 `sign-out` 用 POST 因为是动作而非资源 CRUD。排行榜是 GET 幂等查询，后端从 Redis ZSet 读取。

## 小组

```
GET    /api/teams                    # 可见小组列表
POST   /api/teams                    # 创建小组
GET    /api/teams/{id}               # 小组详情
PUT    /api/teams/{id}               # 修改小组信息（组长/小组管理员）
DELETE /api/teams/{id}               # 删除小组（组长退出）
POST   /api/teams/{id}/join          # 申请/加入小组
DELETE /api/teams/{id}/members/me    # 退出小组
GET    /api/teams/{id}/members       # 成员列表
GET    /api/teams/{id}/problem-sets  # 小组题库列表
GET    /api/teams/{id}/contests      # 小组比赛列表
```

小组用雪花 ID 访问（没有 displayId 的设计）。退出小组用 `DELETE /members/me`，语义是"删除我这个成员资源"。小组下挂题库和比赛列表，体现归属关系。

## 排行榜

```
GET    /api/ranking                  # 全局过题排行榜（分页）
```

单独一个端点，简单直接。

## 出题（Polygon）

```
GET    /api/polygon/problems                    # 我创建的题目列表
POST   /api/polygon/problems                    # 创建题目草稿
GET    /api/polygon/problems/{id}               # 题目详情（编辑视角）
PUT    /api/polygon/problems/{id}               # 更新题目
DELETE /api/polygon/problems/{id}               # 删除草稿
POST   /api/polygon/problems/{id}/submit-review # 提交审核
POST   /api/polygon/problems/{id}/verify        # 验题（提交代码跑测试点）

GET    /api/polygon/problems/{id}/testcases           # 测试点列表
POST   /api/polygon/problems/{id}/testcases           # 上传测试点
PUT    /api/polygon/problems/{id}/testcases/{tcId}    # 更新测试点
DELETE /api/polygon/problems/{id}/testcases/{tcId}    # 删除测试点
POST   /api/polygon/problems/{id}/testcases/generate  # 用标程生成输出
PUT    /api/polygon/problems/{id}/testcases/sort       # 测试点重排序
```

出题系统用 `/polygon` 前缀隔离，和公共题目接口分开，避免权限混乱。这里用题目的雪花 ID（不是 displayId，因为草稿阶段还没分配 displayId）。`submit-review` 和 `generate` 是动作型端点用 POST。

## 管理后台

```
# 用户管理
GET    /api/admin/users                          # 用户列表（分页搜索）
GET    /api/admin/users/{id}                     # 用户详情
PUT    /api/admin/users/{id}                     # 修改用户（重置密码、改权限组等）
DELETE /api/admin/users/{id}                     # 软删除用户
POST   /api/admin/users/batch                    # 批量创建用户

# 权限组管理
GET    /api/admin/permission-groups
POST   /api/admin/permission-groups
PUT    /api/admin/permission-groups/{id}
DELETE /api/admin/permission-groups/{id}

# 题目管理（含审核）
GET    /api/admin/problems                       # 全部题目列表
PUT    /api/admin/problems/{id}                  # 编辑题目
PUT    /api/admin/problems/{id}/review           # 审核（通过/拒绝 + 分配 displayId）
DELETE /api/admin/problems/{id}                  # 软删除

# 题库管理
GET    /api/admin/problem-sets
POST   /api/admin/problem-sets
PUT    /api/admin/problem-sets/{id}
DELETE /api/admin/problem-sets/{id}
PUT    /api/admin/problem-sets/{id}/problems     # 批量管理题目（增删、排序）

# 比赛管理
GET    /api/admin/contests
POST   /api/admin/contests
PUT    /api/admin/contests/{id}
DELETE /api/admin/contests/{id}
POST   /api/admin/contests/{id}/rejudge          # 重判（整场/单题/单提交）
PUT    /api/admin/contests/{id}/unfreeze          # 手动解榜
GET    /api/admin/contests/{id}/balloons          # 气球请求列表
PUT    /api/admin/contests/{id}/balloons/{bId}    # 更新气球状态
GET    /api/admin/contests/{id}/prints            # 打印请求列表
PUT    /api/admin/contests/{id}/prints/{pId}      # 更新打印状态
PUT    /api/admin/contests/{id}/participants      # 管理参赛者（批量添加/移除）
GET    /api/admin/contests/{id}/clarifications    # 答疑列表（管理员视角）
PUT    /api/admin/contests/{id}/clarifications/{cId}  # 回复答疑

# 标签管理
POST   /api/admin/tag-categories
PUT    /api/admin/tag-categories/{id}
DELETE /api/admin/tag-categories/{id}
POST   /api/admin/tags
PUT    /api/admin/tags/{id}
DELETE /api/admin/tags/{id}

# 小组管理（root 视角）
GET    /api/admin/teams
PUT    /api/admin/teams/{id}
DELETE /api/admin/teams/{id}
PUT    /api/admin/teams/{id}/members/{userId}     # 调整成员角色/踢人

# 全局配置
GET    /api/admin/config                          # 全部配置项
PUT    /api/admin/config/{key}                    # 修改单项配置

# 全局公告
GET    /api/admin/announcements
POST   /api/admin/announcements
PUT    /api/admin/announcements/{id}
DELETE /api/admin/announcements/{id}

# 系统监控
GET    /api/admin/monitor                         # CPU/内存/磁盘/网络状态
```

管理后台统一 `/api/admin` 前缀，方便在 Spring Security 里做统一的权限拦截。审核用 PUT（更新题目状态），重判用 POST（触发动作）。配置项用 key 作为路径参数，和你 `system_config` 表的 `config_key` 主键对应。

## WebSocket / SSE 端点

```
GET    /api/ws/notifications         # WebSocket：实时通知推送
GET    /api/sse/submissions/{id}     # SSE：判题结果实时推送
GET    /api/sse/contests/{displayId}/rank  # SSE：比赛排行榜实时更新
```

通知用 WebSocket（双向，支持已读回执）；判题结果和排行榜用 SSE（服务端单向推送，更轻量）。和你技术选型里 "WebSocket 双向 + SSE 单向" 的规划一致。

