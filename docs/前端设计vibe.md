> 该设计仅为草稿，实际可能会变动。由 Claude Opus 4.6 生成，用于 Vibe Coding 实现前端。

## 1. 设计目标

四个核心原则，所有页面和组件决策以此为锚：

1. **快读**：用户在 1-2 秒内定位关键信息
2. **快判**：当前能否提交、结果是什么、下一步做什么，一眼可知
3. **低错**：高压场景（比赛、考试）下减少误操作和认知负担
4. **可追踪**：每条提交、每个状态变化可回看、可解释

产品气质：`理性、克制、清晰、稳定`。OJ 是工具型产品，信息秩序优先于视觉风格。

## 2. 设计 Token

所有数值在全站统一引用，避免 vibe coding 时样式漂移。

### 2.1 间距

| Token | 值 | 用途 |
|-------|------|------|
| spacing-xs | 4px | 图标与文字间距、标签内边距 |
| spacing-sm | 8px | 紧凑列表行内间距、表格单元格内边距 |
| spacing-md | 16px | 卡片内边距、表单项间距 |
| spacing-lg | 24px | 模块间距、区块分隔 |
| spacing-xl | 32px | 页面级区块间距 |
| spacing-2xl | 48px | 页面顶部/底部留白 |

### 2.2 圆角

| Token | 值 | 用途 |
|-------|------|------|
| radius-sm | 4px | 按钮、输入框、标签 |
| radius-md | 8px | 卡片、弹窗、下拉菜单 |
| radius-lg | 12px | 大卡片、模态框 |
| radius-full | 9999px | 头像、圆形徽标 |

### 2.3 阴影

| Token | 值 | 用途 |
|-------|------|------|
| shadow-sm | 0 1px 2px rgba(0,0,0,0.06) | 卡片默认态 |
| shadow-md | 0 4px 12px rgba(0,0,0,0.08) | 卡片悬浮态、下拉菜单 |
| shadow-lg | 0 8px 24px rgba(0,0,0,0.12) | 模态框、弹窗 |

### 2.4 字号与行高

| Token | 字号 | 行高 | 用途 |
|-------|------|------|------|
| text-xs | 12px | 16px | 辅助文字、时间戳 |
| text-sm | 13px | 20px | 表格内容、标签文字 |
| text-base | 14px | 22px | 正文、表单标签 |
| text-lg | 16px | 24px | 模块标题、导航项 |
| text-xl | 20px | 28px | 页面标题 |
| text-2xl | 24px | 32px | 大标题 |

字体栈：

- 正文：系统默认无衬线字体（-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif）
- 代码：等宽字体（"JetBrains Mono", "Fira Code", "Source Code Pro", Consolas, monospace）

### 2.5 内容宽度

| Token | 值 | 用途 |
|-------|------|------|
| max-width-content | 1200px | 前台主内容区 |
| max-width-admin | 1400px | 后台管理区 |
| max-width-narrow | 480px | 登录、注册等单列表单页 |

### 2.6 动画

| Token | 值 | 用途 |
|-------|------|------|
| duration-fast | 150ms | hover 态、focus 态 |
| duration-normal | 250ms | 展开/收起、切换 |
| duration-slow | 400ms | 页面过渡、模态框出入 |
| easing-default | cubic-bezier(0.4, 0, 0.2, 1) | 通用缓动 |

## 3. 颜色系统

### 3.1 语义色定义

每种语义色定义 light / dark 两套值，为暗色模式预留。

| 语义 | 用途 | Light | Dark |
|------|------|-------|------|
| primary | 主交互（按钮、链接、当前导航） | #165DFF | #3C7EFF |
| success | 通过、完成、正向结果 | #00B42A | #27C346 |
| warning | 等待、风险提示、临界状态 | #FF7D00 | #FF9A2E |
| danger | 失败、拒绝、异常 | #F53F3F | #F76560 |
| info | 中性提示、辅助信息 | #86909C | #A9AEB8 |

背景与文字色：

| 语义 | Light | Dark |
|------|-------|------|
| bg-page | #F7F8FA | #17171A |
| bg-card | #FFFFFF | #232324 |
| bg-hover | #F2F3F5 | #2A2A2B |
| bg-code | #F7F8FA | #1D1D1F |
| text-primary | #1D2129 | #F6F6F6 |
| text-secondary | #4E5969 | #A9AEB8 |
| text-disabled | #C9CDD4 | #5C5C5C |
| border-default | #E5E6EB | #3F3F3F |

### 3.2 提交状态色映射

与数据库 `submission.status` 的 14 种状态完整对应：

| status | 缩写 | 颜色语义 | 文案 | 说明 |
|--------|------|----------|------|------|
| 0 | WT0 | info | Pending | 等待判题 |
| 1 | WT1 | info | Pending Rejudge | 等待重判 |
| 2 | CI | warning | Compiling | 编译中 |
| 3 | RI | warning | Judging | 运行评测中 |
| 4 | AC | success | Accepted | 通过 |
| 5 | PE | warning | Presentation Error | 格式错误，介于对错之间 |
| 6 | WA | danger | Wrong Answer | 答案错误 |
| 7 | TLE | danger | Time Limit Exceeded | 超时 |
| 8 | MLE | danger | Memory Limit Exceeded | 超内存 |
| 9 | OLE | danger | Output Limit Exceeded | 输出超限 |
| 10 | RE | danger | Runtime Error | 运行错误 |
| 11 | CE | danger | Compile Error | 编译错误 |
| 12 | SE | info | System Error | 系统错误，非用户问题 |
| 13 | NT | info | No Test Data | 无测试数据 |

规则：

- AC 是唯一的 success
- PE 用 warning，因为"差一点对"，需要用户注意格式
- SE / NT 用 info 而非 danger，因为不是用户的错
- 进行中状态（WT0/WT1/CI/RI）统一用 info 或 warning，配合动画指示器区分

### 3.3 比赛与题目状态色

| 状态 | 颜色 | 场景 |
|------|------|------|
| 未开始 | info | 比赛列表 |
| 进行中 | success | 比赛列表、比赛详情 |
| 已结束 | text-disabled | 比赛列表 |
| 封榜中 | warning | 榜单页 |
| 已通过 | success | 题库列表中的题目状态 |
| 未通过 | danger | 题库列表中的题目状态 |
| 未尝试 | 无色/默认 | 题库列表中的题目状态 |

## 4. 全局布局

### 4.1 前台布局

```
┌─────────────────────────────────────────────┐
│  顶部导航栏 (固定, 高度 56px)                │
├─────────────────────────────────────────────┤
│                                             │
│         主内容区 (max-width: 1200px)         │
│         水平居中, 两侧 padding: 24px        │
│                                             │
├─────────────────────────────────────────────┤
│  页脚 (非固定)                               │
└─────────────────────────────────────────────┘
```

顶部导航栏内容：

- 左侧：OJ Logo + 名称、题库、比赛、状态、排行榜、讨论（根据 system_config 控制显示）
- 右侧：通知铃铛（带未读 badge）、用户头像/昵称下拉菜单（个人主页、设置、后台管理入口、退出）
- 未登录时右侧显示：登录 / 注册按钮

### 4.2 后台布局

```
┌──────────┬──────────────────────────────────┐
│          │  顶部栏 (面包屑 + 用户信息)       │
│  侧边栏   ├──────────────────────────────────┤
│  (宽200px │                                  │
│  可折叠)  │  内容区 (max-width: 1400px)       │
│          │                                  │
│          │                                  │
└──────────┴──────────────────────────────────┘
```

侧边栏导航分组：

- 仪表盘（监控）
- 用户管理（用户列表、权限组）
- 题目管理（题目列表、标签管理、审核队列）
- 题库管理
- 比赛管理
- 小组管理
- 系统设置（全局配置、公告管理）
- 通知中心

### 4.3 响应式断点

| 断点 | 宽度 | 布局变化 |
|------|------|----------|
| desktop | ≥1024px | 完整双栏布局 |
| tablet | 768-1023px | 侧栏折叠为抽屉，内容区全宽 |
| mobile | <768px | 单栏，顶部导航收纳为汉堡菜单，表格转卡片 |

具体降级规则：

- 题目详情页：双栏 → 侧栏信息折叠到题面上方
- 榜单表格：横向可滚动，固定排名列和用户名列
- 代码编辑器：全宽，高度降为 300px（移动端建议提示用户使用桌面端）
- 后台侧边栏：tablet 下默认折叠，点击展开为 overlay

## 5. 前台页面设计

### 5.1 首页

目标：建立入口感，快速进入任务。

```
┌─────────────────────────────────────────┐
│  横幅通知 (若 system_config.banner 非空) │
├─────────────────────────────────────────┤
│                                         │
│  快捷入口卡片 (4列)                      │
│  [题库] [比赛] [状态] [排行榜]           │
│                                         │
├─────────────────────────────────────────┤
│  最新公告列表          │  近期比赛列表    │
│  (announcement 表)    │  (contest 表)   │
│  标题 + 时间           │  标题+状态+时间  │
│  点击进入详情          │  点击进入详情    │
│                       │                 │
└─────────────────────────────────────────┘
```

- 横幅通知：可关闭，关闭后本次会话不再显示
- 快捷入口：图标 + 文字，hover 有微弱上浮动画
- 公告列表：最多显示 5 条，溢出显示"查看全部"
- 比赛列表：最多显示 5 条，按 start_at 降序，状态标签（未开始/进行中/已结束）

单例比赛模式（`system_config.singleton_contest_id` 非空且比赛进行中）：首页直接重定向到比赛详情页，顶部导航只保留比赛相关入口。

### 5.2 登录 / 注册页

单列居中布局，max-width: 480px。

登录表单：
- 用户名输入框
- 密码输入框（带显示/隐藏切换）
- 图形验证码（Hutool Captcha 生成，点击刷新）
- 登录按钮（主色，全宽）
- 底部链接：忘记密码 / 注册

注册表单（根据 system_config 控制是否开放）：
- 用户名（实时校验格式：大小写英文 + 数字 + `-_.`）
- 昵称
- 密码 + 确认密码（强度指示器）
- 邮箱（若 `register_email_verify=true` 则必填，附验证码发送按钮）
- 防重字段（若配置了 user_attribute 防重列，动态渲染对应输入框）
- 图形验证码
- 注册按钮

### 5.3 题库页

目标：快速筛题，高密度可扫描。

```
┌─────────────────────────────────────────┐
│  题库选择器 (下拉/Tab: 公共题库 / 各小组题库)│
├─────────────────────────────────────────┤
│  筛选栏                                  │
│  [搜索框] [难度下拉] [标签多选] [状态筛选] │
├─────────────────────────────────────────┤
│  题目列表 (表格)                          │
│  状态 | 显示ID | 标题 | 难度 | 通过/提交  │
│  ──────────────────────────────────────  │
│  ✓   | A      | 两数之和 | 800 | 120/200 │
│  ✗   | B      | 最短路径 | 1400| 30/150  │
│  -   | C      | 区间DP  | 2000| 5/80    │
├─────────────────────────────────────────┤
│  分页器 (支持跳转到指定页)                 │
└─────────────────────────────────────────┘
```

- 状态列：✓（已通过，success 色）、✗（尝试未通过，danger 色）、-（未尝试，无色）
- 难度列：数值 + 对应颜色条（可参考 CF rating 色阶：灰/绿/青/蓝/紫/橙/红）
- 标签筛选：按 tag_category 分组展示，每组内多选
- 搜索：支持题目标题模糊搜索，回车或点击触发
- 分页器：显示总页数，支持输入页码跳转，首页/末页快捷按钮

### 5.4 题目详情页

目标：完成从阅读到提交的完整闭环。采用双栏布局。

```
┌──────────────────────────┬──────────────┐
│  题目标题 + 显示ID        │  题目信息侧栏  │
│  标签列表                 │  时间限制      │
├──────────────────────────┤  内存限制      │
│                          │  难度          │
│  题面描述 (Markdown渲染)  │  来源/标签     │
│                          │  通过/提交统计  │
│  输入描述                 │              │
│  输出描述                 │  我的提交      │
│                          │  (最近3条摘要) │
│  样例区域                 │              │
│  ┌─────────┬─────────┐  │              │
│  │ 输入     │ 输出    │  │              │
│  │ (可复制) │ (可复制)│  │              │
│  └─────────┴─────────┘  │              │
│  样例2...                │              │
│                          │              │
│  提示/说明                │              │
│                          │              │
├──────────────────────────┤              │
│  提交区域                 │              │
│  [语言选择] [公开/私密]   │              │
│  ┌──────────────────┐   │              │
│  │  Monaco Editor    │   │              │
│  │  (最小高度300px)  │   │              │
│  └──────────────────┘   │              │
│  [提交] [重置]           │              │
└──────────────────────────┴──────────────┘
```

样例区域：
- 每个样例左右并排显示输入和输出
- 右上角复制按钮，点击后显示"已复制"反馈（1.5s 后消失）
- 多个样例纵向堆叠，标注"样例 1"、"样例 2"

提交区域：
- 语言选择器：下拉菜单，记住用户上次选择（localStorage）
- 公开/私密切换：默认取 `user.default_code_public`
- Monaco Editor 配置：
  - 最小高度 300px，最大高度 600px，可拖拽调整
  - 根据语言选择自动切换语法高亮
  - 显示行号、缩进参考线
  - 支持常用快捷键（Ctrl+Z 撤销、Ctrl+Shift+Z 重做等）
- 提交按钮：点击后立即 disable 并显示 spinner，防重复提交
- 提交频率限制：距上次提交不足间隔时，按钮 disable 并显示倒计时

提交后反馈（原位更新，不跳转）：
- 提交区域下方出现结果卡片
- 状态实时更新（通过 WebSocket/SSE 推送，详见第 7 节）

页内 Tab 导航（题面下方或顶部）：
- 题目 | 提交记录 | 题解 | 讨论

题解 Tab：
- 若 `problem.solution_visible=true`，渲染 Markdown 题解
- 若不可见，显示"题解暂未公开"

讨论 Tab：
- 主帖列表（置顶优先，按时间降序）
- 点击进入主帖详情，显示二级回复
- 发帖/回复使用 Markdown 编辑器

### 5.5 提交状态页

目标：快速排查提交结果，紧凑可扫描。

```
┌─────────────────────────────────────────────────────────┐
│  筛选栏                                                  │
│  [用户名] [题目ID] [状态下拉] [语言下拉] [只看赛时☐]     │
├─────────────────────────────────────────────────────────┤
│  提交列表 (表格)                                         │
│  运行ID | 作者 | 题目 | 结果 | 分数 | 用时 | 内存 | 语言 | 代码长度 | 提交时间 │
│  ─────────────────────────────────────────────────────  │
│  #1234 | alice | A-两数之和 | AC | 满分 | 12ms | 3.2MB | C++ | 1.2KB | 2分钟前 │
│  #1233 | bob   | B-最短路径 | WA(3/11) | 27 | 156ms| 12MB | Java| 2.8KB | 5分钟前 │
├─────────────────────────────────────────────────────────┤
│  分页器                                                  │
└─────────────────────────────────────────────────────────┘
```

- 结果列：状态缩写 + 对应颜色标签；非 AC 时显示通过测试点数如 `WA(3/11)`
- 分数列：ACM 模式不显示；OI/IOI 模式显示分数，满分时显示"满分"（success 色）
- 用时/内存：评测完成前显示 `-`
- 作者列：点击跳转用户主页
- 题目列：显示 `显示ID-标题`，点击跳转题目详情

点击某行展开提交详情：
- 完整代码（代码高亮，带行号，带复制/下载按钮）
- 编译输出（CE 时显示）
- 测试点结果表格（根据题库 testcase_view 设置决定显示内容）：

| 测试点 | 结果 | 用时 | 内存 |
|--------|------|------|------|
| #1 | AC | 4ms | 1.2MB |
| #2 | WA | 8ms | 1.3MB |
| ... | | | |

- 代码可见性：私密代码仅作者和比赛管理员可见，其他用户看到"代码未公开"

### 5.6 比赛列表页

```
┌─────────────────────────────────────────┐
│  筛选栏                                  │
│  [搜索框] [状态: 全部/进行中/未开始/已结束]│
├─────────────────────────────────────────┤
│  比赛卡片列表                             │
│  ┌─────────────────────────────────┐    │
│  │ [进行中]  第3届校赛              │    │
│  │ ACM制 | 2025-01-15 09:00 - 14:00│    │
│  │ 已报名 128 人                    │    │
│  └─────────────────────────────────┘    │
│  ┌─────────────────────────────────┐    │
│  │ [未开始] 期末考试                │    │
│  │ OI制 | 2025-01-20 14:00 - 17:00 │    │
│  │ 邀请码加入                       │    │
│  └─────────────────────────────────┘    │
├─────────────────────────────────────────┤
│  分页器                                  │
└─────────────────────────────────────────┘
```

- 状态标签：进行中（success 色）、未开始（info 色）、已结束（text-disabled 色）
- 卡片信息：标题、赛制、时间范围、参与人数/准入方式
- 进行中的比赛置顶显示

### 5.7 比赛详情页

比赛详情页是一个独立的子站结构，顶部显示比赛信息，内部通过 Tab 导航。

```
┌─────────────────────────────────────────┐
│  比赛标题                                │
│  状态标签 | 赛制 | 时间范围              │
│  倒计时 (距开始/距结束/距解榜)            │
├─────────────────────────────────────────┤
│  [概览] [题目] [状态] [榜单] [公告] [答疑]│
├─────────────────────────────────────────┤
│  (Tab 内容区)                            │
└─────────────────────────────────────────┘
```

概览 Tab：
- 比赛描述（Markdown 渲染）
- 报名/加入按钮（根据 access_mode 显示不同入口）
- 签退按钮（若已签退则显示"已签退"且不可操作）

题目 Tab：
- 题目列表（显示ID、标题、通过数/提交数）
- 点击进入题目详情（在比赛上下文内，URL 包含比赛 ID）

状态 Tab：
- 与全局状态页结构相同，但限定为本比赛的提交

榜单 Tab（详见 5.8）

公告 Tab：
- 公告列表，按时间降序
- 新公告到达时顶部出现提示条（通过 WebSocket 推送）

答疑 Tab（若 `contest.enable_clar=true`）：
- 我的提问列表 + 发起提问表单
- 公开答疑列表（`is_public=true` 的问答）
- 新回复到达时出现提示

### 5.8 榜单页

OJ 中信息密度最高的页面，需要特别处理。

```
┌──────────────────────────────────────────────────────┐
│  榜单标题 | [封榜中⚠️] | [自动刷新: 开/关]            │
├──────────────────────────────────────────────────────┤
│  排名 | 用户 | 总分/过题 | 罚时 | A | B | C | D | ...│
│  ─────────────────────────────────────────────────── │
│  1 ★ | alice  | 5/300  |      | ● | ● | ● | ● | ●  │
│  2   | bob    | 4/450  |      | ● | ● | ◐ | ● | ○  │
│  ...                                                 │
│  ── 你在这里 ──                                       │
│  42  | 我     | 2/120  |      | ● | ○ | ○ | ● | ○  │
├──────────────────────────────────────────────────────┤
│  分页器 / 虚拟滚动                                    │
└──────────────────────────────────────────────────────┘
```

视觉规则：

- 首杀（First Blood）：在对应题目单元格显示特殊标记（如 🎈 或加粗边框），行内不额外高亮避免干扰
- 当前用户行：低饱和 primary 底色（如 primary/5% opacity），始终可见——若不在当前视口，底部显示浮动条"你的排名：#42"，点击可滚动定位
- 封榜状态：封榜后的提交在对应单元格显示 `?` 占位符，背景用 warning/5% opacity 淡色条纹
- 题目单元格状态：
  - ● 已通过（success 色），hover 显示提交次数和时间
  - ◐ 封榜中待揭晓（warning 色 + `?`）
  - ✗ 尝试未通过（danger 色），hover 显示尝试次数
  - ○ 未尝试（border 色空心圆）

ACM 模式特有：
- 罚时列显示总罚时
- 单元格 hover 显示：`+N (HH:MM:SS)` 格式（N 为错误次数，时间为 AC 时间）

OI/IOI 模式特有：
- 总分列显示实际得分
- 单元格显示该题得分，满分时用 success 色

气球颜色：若 `contest.enable_balloon=true`，每道题分配一个固定颜色（按题目顺序从预定义色板取），在表头题目列显示对应色块。

性能：参赛者超过 200 人时启用虚拟滚动（只渲染可视区域行），避免 DOM 过多导致卡顿。

### 5.9 排行榜页（全局）

与比赛榜单不同，这是全站用户的过题数排名。

```
┌─────────────────────────────────────────┐
│  排行榜 (每日刷新)                       │
│  上次更新: 2025-01-15 00:00             │
├─────────────────────────────────────────┤
│  排名 | 用户 | 过题数 | 提交数 | 通过率 |
│  ─────────────────────────────────────  │
│  1  | alice | 523 | 1024 | 51.1%       │
│  1  | bob   | 523 | 890  | 58.8%       │
│  3  | carol | 510 | 760  | 67.1%       │
├─────────────────────────────────────────┤
│  分页器                                  │
└─────────────────────────────────────────┘
```

- 同过题数同名次，与数据库设计一致
- 点击用户名跳转用户主页
- 显示上次刷新时间（`ranking_refresh_interval` 控制）

### 5.10 用户主页

```
┌─────────────────────────────────────────┐
│  用户信息卡片                             │
│  昵称 | 用户名 | 注册时间 | 最后登录      │
├──────────────────┬──────────────────────┤
│  统计卡片 (3列)   │                      │
│  过题数 | 提交数  │  个人主页             │
│  通过率          │  (Markdown 渲染)      │
├──────────────────┤                      │
│  已通过题目列表   │                      │
│  (可搜索, 分页)   │                      │
├──────────────────┤                      │
│  未通过题目列表   │                      │
│  (可搜索, 分页)   │                      │
└──────────────────┴──────────────────────┘
```

- 已通过/未通过列表：显示题目显示 ID + 标题，支持搜索过滤
- 个人主页 Markdown：若为空显示"这个人很懒，什么都没写"
- 非本人访问时隐藏敏感信息（邮箱等）

### 5.11 个人设置页

Tab 分区：基本信息 | 安全设置

基本信息 Tab：
- 昵称修改（限频提示：每天一次）
- 邮箱修改（需验证码确认）
- 个人主页 Markdown 编辑器（限频提示：每天一次）
- 默认代码公开/私密切换

安全设置 Tab：
- 修改密码（旧密码 + 新密码 + 确认）
- 忘记密码申诉入口（提交申诉请求，由管理员处理）

### 5.12 通知页

```
┌─────────────────────────────────────────┐
│  通知列表                                │
│  [全部] [未读] [已读]                    │
│  [全部标为已读]                           │
├─────────────────────────────────────────┤
│  ● 你在题目"两数之和"的讨论被回复了       │
│    2分钟前                               │
│  ○ 你的题目"最短路径"审核已通过           │
│    1小时前                               │
├─────────────────────────────────────────┤
│  分页器                                  │
└─────────────────────────────────────────┘
```

- ● 未读（primary 色圆点）、○ 已读（无圆点）
- 点击通知项跳转到对应资源页面，同时标记为已读
- 顶部导航栏铃铛图标显示未读数 badge（超过 99 显示 99+）

### 5.13 讨论页（全局）

若 `system_config.discussion_enabled=true` 则显示。

```
┌─────────────────────────────────────────┐
│  讨论列表                                │
│  [搜索框] [关联题目筛选]                  │
├─────────────────────────────────────────┤
│  📌 关于评测机维护的说明 - admin - 3回复  │
│  如何优化DP状态转移 - alice - 12回复      │
│  B题样例疑问 - bob - 5回复               │
├─────────────────────────────────────────┤
│  分页器                                  │
└─────────────────────────────────────────┘
```

- 置顶帖 📌 标记，始终在最前
- 每行显示：标题、作者、回复数、最后回复时间
- 发帖按钮（需登录）

讨论详情页：
- 主帖内容（Markdown 渲染）
- 回复列表（按时间升序）
- 二级回复显示"回复 @xxx"前缀
- 回复输入框固定在底部

### 5.14 公告详情页

Markdown 渲染的公告正文，顶部显示标题、发布时间、更新时间。底部显示"返回公告列表"链接。

### 5.15 帮助文档页

静态 Markdown 页面，内容包括：
- 评测状态说明
- 支持的语言与编译参数
- 常见问题
- 代码限制说明

## 6. 后台页面设计

### 6.1 仪表盘

```
┌─────────────────────────────────────────┐
│  系统状态卡片 (4列)                       │
│  [运行时间] [CPU] [内存] [磁盘]          │
├─────────────────────────────────────────┤
│  实时监控图表                             │
│  CPU/内存使用率折线图 (最近1小时)          │
│  网络流量折线图 (入网/出网)               │
├──────────────────┬──────────────────────┤
│  今日统计         │  待处理事项           │
│  提交数 / AC数    │  待审核题目: 3        │
│  新注册用户: 12   │  账号申诉: 1          │
│  活跃比赛: 2      │  待处理通知: 5        │
└──────────────────┴──────────────────────┘
```

- 监控数据来源：Prometheus + Grafana，后台页面嵌入 Grafana iframe 或通过 API 拉取关键指标
- 待处理事项：点击直接跳转到对应管理页面

### 6.2 用户管理

列表页：
- 搜索：用户名、昵称、邮箱模糊搜索
- 筛选：权限组下拉
- 表格列：用户名、昵称、权限组、邮箱、注册时间、最后登录、操作
- 操作：编辑、重置密码、禁用/启用（软删除）
- 批量操作：批量创建用户（上传 CSV）、批量修改权限组

编辑弹窗（模态框）：
- 表单字段与 user 表对应
- 权限组选择器
- 保存时校验，失败在对应字段下方显示红色错误文案

权限组管理（子页面）：
- 权限组列表，内置组标记不可删除
- 编辑权限组：名称、描述、权限多选（按模块分组的 checkbox 列表）

### 6.3 题目管理

列表页：
- 搜索：题目 ID、标题
- 筛选：状态（草稿/待审核/已发布/已下架）、创建者、标签
- 表格列：ID、显示 ID、标题、状态、创建者、创建时间、操作
- 操作：编辑、审核（待审核状态）、上架/下架、删除（软删除）

审核队列（子页面）：
- 只显示 `status=1`（待审核）的题目
- 审核操作：通过（设为已发布，分配显示 ID）/ 驳回（设为草稿，附驳回理由）
- 审核通过/驳回后自动发送通知给创建者

题目编辑页（独立页面，非弹窗，因为内容多）：
- 分区表单：
  1. 基本信息：标题、显示 ID（管理员可设）、难度、标签选择
  2. 题面：Markdown 编辑器（支持实时预览、图片上传到 MinIO）
  3. 输入输出描述：两个 Markdown 编辑器
  4. 样例管理：动态增删样例对，每对包含输入和输出的文本域
  5. 提示/说明：Markdown 编辑器
  6. 评测配置：时间限制、内存限制、评测模式（常规/SPJ/填空/交互）、SPJ 代码编辑器
  7. 测试点管理：上传区域（拖拽上传 zip 或逐个上传）、测试点列表（可拖拽排序、删除）、一键生成输出按钮（需先上传标程）
  8. 标程与题解：标程代码编辑器 + 语言选择、题解 Markdown 编辑器、可见性开关
  9. 评分配置：scoring_config JSON 编辑器或可视化分组配置界面
- 底部操作栏（固定在视口底部）：保存草稿 | 提交审核 | 发布（管理员/root）

标签管理（子页面）：
- 标签分类列表（可拖拽排序）
- 每个分类下的标签列表（可拖拽排序）
- 增删改操作

### 6.4 题库管理

列表页：
- 表格列：ID、题库名、所属小组、题目数、创建者、创建时间、操作
- 操作：编辑、删除（软删除）

编辑页：
- 基本信息：题库名、描述、所属小组、显示格式（字母/数字）、测试点查看方式、标签选择
- 题目管理区域：
  - 左侧：已选题目列表（可拖拽排序，显示显示 ID + 标题，可修改显示 ID，可移除）
  - 右侧：题目搜索与选择面板（搜索框 + 题目列表，点击添加）
  - 支持批量选择（按标签、按难度范围、按创建者）

### 6.5 比赛管理

列表页：
- 筛选：状态（未开始/进行中/已结束）、所属小组
- 表格列：显示 ID、标题、赛制、时间范围、状态、参赛人数、操作
- 操作：编辑、删除（软删除）、进入比赛管理面板

比赛编辑页（表单分区）：
1. 基本信息：标题、显示 ID、描述、所属小组、关联题库（下拉选择）
2. 赛制与时间：赛制选择、开始/结束时间（日期时间选择器）、封榜时间、解榜时间、罚时
3. 准入与可见性：准入方式、邀请码（access_mode=1 时显示）、可见性
4. 功能开关：榜单可见性、提交信息可见性、答疑、气球、打印、判题优先级
5. 参赛者管理（access_mode=2 时）：用户搜索添加、批量导入（CSV）、已添加列表

比赛管理面板（比赛进行中的操作中心）：
- 公告管理：发布/编辑/删除公告
- 答疑管理：未回复列表、回复操作、设为公开
- 气球管理：待处理/处理中/已完成列表，状态调整
- 打印管理：同气球管理结构
- 重判操作：按提交 ID / 按题目 / 全场重判，二次确认弹窗
- 手动解榜按钮

### 6.6 小组管理

列表页：
- 表格列：ID、小组名、成员数、创建者、加入方式、可见性、操作
- 内置小组标记不可删除

编辑页：
- 基本信息：小组名、描述、加入方式、邀请码、可见性
- 成员管理：成员列表（角色、加入时间）、角色调整、移除成员、待审批列表（join_mode=2 时）

### 6.7 系统设置

全局配置页：
- 按分组展示配置项（与 system_config 表对应）
- 每项显示：配置名、当前值、说明、编辑控件（文本框/开关/数字输入/下拉）
- 修改后即时保存，显示"已保存"反馈
- 分组：基础设置、注册设置、提交设置、功能开关、邮箱配置、AI 配置

公告管理页：
- 公告列表：标题、可见性开关、创建时间、操作（编辑/删除）
- 编辑：标题 + Markdown 编辑器 + 可见性开关

### 6.8 通知中心（后台）

与前台通知页结构相同，但额外显示管理员专属通知类型：
- 审题通知：新题目待审核
- 账号申诉通知：用户请求重置密码

## 7. 实时推送 UI 状态机

### 7.1 判题结果推送

传输方式：SSE（服务端单向推送，轻量）

状态流转与 UI 表现：

```
提交 → WT0(Pending) → CI(Compiling) → RI(Judging) → 终态
```

| 阶段 | UI 表现 |
|------|---------|
| 提交成功 | 提交按钮恢复，结果卡片出现，显示"Pending"+ spinner |
| WT0 → CI | 状态文案切换为"Compiling"，spinner 继续 |
| CI → RI | 状态文案切换为"Judging"，若有测试点进度则显示进度条 `3/11` |
| RI → 终态 | spinner 消失，显示最终状态标签（颜色 + 文案），展开测试点详情 |
| 连接断开 | 显示"连接已断开，正在重连..."提示条，自动重连（指数退避，最大 30s） |
| 超时无响应(>60s) | 显示"评测可能延迟，请稍后刷新查看"，提供手动刷新按钮 |

在提交列表页，当前用户的提交行也通过 SSE 实时更新状态，无需手动刷新。

### 7.2 通知推送

传输方式：WebSocket（需要双向通信支持已读回执）

| 事件 | UI 表现 |
|------|---------|
| 新通知到达 | 导航栏铃铛 badge 数字 +1，若页面可见则右上角弹出 toast（3s 自动消失） |
| 比赛公告到达 | 比赛详情页顶部出现蓝色提示条"有新公告"，点击滚动到公告 Tab |
| 答疑回复到达 | 比赛答疑 Tab 内对应问题显示"新回复"标记 |
| 管理员专属通知 | 后台侧边栏对应菜单项显示红点 |

连接管理：
- 页面加载时建立 WebSocket 连接
- 心跳间隔 30s，超时自动重连
- 用户切换页面（SPA 路由跳转）不断开连接
- 用户退出登录时主动关闭连接

### 7.3 比赛榜单刷新

传输方式：轮询（30s 间隔）或 SSE

| 场景 | 行为 |
|------|------|
| 正常刷新 | 静默更新数据，排名变化的行做短暂高亮动画（0.5s 淡黄色闪烁） |
| 封榜后 | 停止更新封榜后的数据，新提交对应单元格显示 `?` |
| 解榜 | 若实现滚榜动画，逐行揭晓；否则直接刷新为最终榜单 |
| 用户手动关闭自动刷新 | 显示"榜单已暂停刷新"提示，提供手动刷新按钮 |

## 8. 加载与空状态

### 8.1 加载态

| 场景 | 方式 |
|------|------|
| 页面首次加载 | 骨架屏（skeleton），模拟最终布局的灰色占位块 |
| 列表/表格加载 | 表格骨架屏（3-5 行灰色占位行） |
| 局部数据刷新 | 对应区域显示小型 spinner，不阻断其他区域交互 |
| 按钮触发操作 | 按钮内 spinner + 文案变为"提交中..."，按钮 disable |
| 文件上传 | 进度条 + 百分比 + 文件名 |

### 8.2 空状态

每个空状态都要回答两个问题：为什么为空、下一步做什么。

| 场景 | 展示 |
|------|------|
| 题库无题目 | 插图 + "暂无题目" + "前往添加题目"按钮（有权限时） |
| 提交列表为空 | "暂无提交记录" + "去做题"链接 |
| 搜索无结果 | "未找到匹配结果，试试其他关键词" |
| 通知为空 | "暂无通知，一切安好" |
| 比赛无参赛者 | "暂无参赛者" + 准入方式说明 |
| 讨论区为空 | "还没有讨论，来发第一帖吧" + 发帖按钮 |

### 8.3 异常状态

| 场景 | 展示 |
|------|------|
| 网络错误 | 页面顶部红色提示条"网络连接异常，请检查网络后重试" + 重试按钮 |
| 403 无权限 | "你没有权限访问此页面" + 返回首页按钮 |
| 404 不存在 | "页面不存在" + 返回首页按钮 |
| 500 服务器错误 | "服务器开小差了，请稍后再试" + 返回首页 + 重试按钮 |
| 接口超时 | 对应区域显示"加载超时" + 重试按钮，不阻断整个页面 |

## 9. 交互规范

### 9.1 反馈及时性

- 所有按钮点击后 150ms 内必须有视觉反馈（hover/active 态变化或 spinner）
- 表单提交成功：绿色 toast "保存成功"（2s 自动消失）
- 表单提交失败：对应字段下方红色错误文案 + 顶部红色 toast 汇总提示
- 复制操作：按钮文案短暂变为"已复制 ✓"（1.5s 后恢复）

### 9.2 二次确认

以下操作必须弹出确认弹窗（模态框，包含明确的操作描述和后果说明）：

- 删除操作（题目、比赛、小组、用户等）
- 重判操作（尤其是全场重判）
- 比赛签退
- 修改权限组
- 批量操作（批量删除、批量修改）

弹窗结构：标题 + 描述文案 + 取消按钮（次要样式）+ 确认按钮（danger 色，文案明确如"确认删除"而非"确定"）

### 9.3 防重复提交

- 代码提交按钮：点击后 disable + spinner，直到收到服务端响应或超时
- 表单保存按钮：点击后 disable，成功/失败后恢复
- 提交频率限制：按钮 disable + 显示倒计时秒数（如"3s 后可再次提交"）

### 9.4 表单校验

- 实时校验：输入框失焦时校验格式（用户名格式、密码强度、邮箱格式）
- 提交时校验：所有必填项 + 格式 + 业务规则（如用户名是否已存在，异步校验）
- 错误展示：字段下方红色文案，输入框边框变红
- 成功展示：字段下方绿色文案或绿色对勾（仅用于异步校验结果，如"用户名可用"）

### 9.5 键盘快捷键

| 快捷键 | 场景 | 动作 |
|--------|------|------|
| Ctrl+Enter | 代码编辑器聚焦时 | 提交代码 |
| Ctrl+S | 后台编辑页 | 保存当前表单 |
| Esc | 模态框打开时 | 关闭模态框 |

## 10. 组件规范

### 10.1 导航组件

顶部导航栏：
- 高度 56px，固定在视口顶部
- 背景色 bg-card，底部 1px border
- 当前页对应的导航项：primary 色文字 + 底部 2px primary 色指示线
- 移动端：折叠为汉堡菜单，点击展开侧边抽屉

后台侧边栏：
- 宽度 200px，可折叠为 64px（只显示图标）
- 当前项：primary 色背景（低透明度）+ primary 色文字
- 分组标题：text-xs 大小，text-disabled 色，大写

页内 Tab 导航：
- 用于同域切换（题目/讨论/题解、比赛子页）
- 当前 Tab：primary 色文字 + 底部 2px 指示线
- 切换时内容区平滑过渡（duration-normal）

### 10.2 数据展示组件

表格：
- 表头：bg-hover 背景，text-secondary 色，text-sm 字号
- 行高：40-44px（紧凑模式）
- 斑马纹：偶数行 bg-hover（可选，数据密集时开启）
- 排序：可排序列表头显示排序箭头，点击切换升/降序
- 行 hover：bg-hover 背景

标签/徽标：
- 状态标签：圆角 radius-sm，内边距 2px 8px，text-xs 字号
- 颜色跟随语义（success/danger/warning/info）
- 数字徽标（badge）：圆形，最小宽度 18px，danger 色背景白色文字

分页器：
- 显示：上一页 / 页码 / 下一页 / 跳转输入框 / 总条数
- 当前页：primary 色背景
- 页码过多时中间用省略号折叠

卡片：
- 背景 bg-card，圆角 radius-md，阴影 shadow-sm
- hover 态：阴影升级为 shadow-md（duration-fast 过渡）
- 内边距 spacing-md

### 10.3 操作组件

按钮层级：
- 主按钮：primary 色背景，白色文字，用于页面主操作（提交、保存、确认）
- 次按钮：白色背景，primary 色边框和文字，用于次要操作（取消、重置）
- 危险按钮：danger 色背景，白色文字，用于删除等破坏性操作
- 文字按钮：无背景无边框，primary 色文字，用于轻量操作（查看更多、编辑）
- 禁用态：所有按钮统一降低透明度至 40%，cursor: not-allowed

输入框：
- 高度 32px，圆角 radius-sm，border 1px border-default
- focus 态：border 变为 primary 色，外发光 primary/20% 的 box-shadow
- 错误态：border 变为 danger 色
- 禁用态：bg-hover 背景，text-disabled 色

### 10.4 Markdown 编辑器

用于题面编辑、个人主页、讨论发帖等场景。

- 工具栏：加粗、斜体、标题、列表、代码块、链接、图片上传、表格、公式
- 支持实时预览（左右分栏或切换模式）
- 图片上传：拖拽或粘贴上传到 MinIO，插入 Markdown 图片链接
- 代码块：语法高亮
- 数学公式：KaTeX 渲染

### 10.5 代码编辑器（Monaco Editor）

统一配置：
- 主题：跟随系统 light/dark 模式
- 字体：代码等宽字体栈
- 显示：行号、缩进参考线、当前行高亮、括号匹配
- 功能：自动缩进、括号自动补全、Ctrl+Z/Y 撤销重做
- 最小高度 300px，可拖拽下边缘调整高度，最大 600px
- 语言切换时自动更新语法高亮模式

## 11. 内容与文案规范

### 11.1 文案语气

- 清晰直接，优先"说明事实 + 指明动作"
- 比赛场景避免冗余鼓励性文本
- 错误提示格式：`[发生了什么] + [建议怎么做]`，如"密码不正确，请重新输入"
- 成功提示简短：如"保存成功"、"提交成功"、"已复制"

### 11.2 时间表达

| 场景 | 格式 | 示例 |
|------|------|------|
| 列表中的时间 | 相对时间（<24h）/ 绝对日期（≥24h） | "3分钟前" / "2025-01-15" |
| 比赛时间 | 绝对时间，精确到分钟 | "2025-01-15 09:00" |
| 比赛倒计时 | `距开始 HH:MM:SS` 或 `距结束 HH:MM:SS` | "距结束 01:23:45" |
| 提交详情时间 | 绝对时间，精确到秒 | "2025-01-15 09:30:12" |
| hover 提示 | 始终显示完整绝对时间 | tooltip: "2025-01-15 09:30:12" |

所有时间前端按用户本地时区显示，后端统一存储 UTC。

### 11.3 数值格式

- 代码长度：`1.2KB`（<1024B 显示字节数）
- 内存：`3.2MB`（<1024KB 显示 KB）
- 时间开销：`12ms`（≥1000ms 显示 `1.2s`）
- 大数字：千位分隔符（如 `1,234`）或缩写（如 `1.2K`）

## 12. 可访问性

- 颜色对比度：正文与背景对比度 ≥ 4.5:1，大文字 ≥ 3:1
- 不单独依赖颜色：所有状态同时使用颜色 + 文字（或图标）表达
- 交互目标尺寸：最小 32×32px（移动端 44×44px）
- 焦点可见：所有可交互元素 focus 态有明显的轮廓线（primary 色 outline）
-语义化标签：导航用 nav，主内容用 main，列表用合适的列表结构，表格用 table/thead/tbody
- 图标与装饰性图片提供替代文本或标记为装饰性
- 表单控件与标签正确关联
- 键盘可达：所有功能可通过 Tab 键导航和 Enter/Space 键触发
- 信息顺序：DOM 顺序与视觉顺序一致

## 13. 暗色模式

### 13.1 切换方式

- 顶部导航栏提供主题切换按钮（太阳/月亮图标），三态切换：浅色 → 深色 → 跟随系统
- 用户选择存储在 localStorage，优先级高于系统偏好
- 切换时全局过渡动画 duration-normal，避免闪烁

### 13.2 实现原则

- 所有颜色通过 CSS 变量引用语义 token（第 3 节定义的 light/dark 两套值），切换时只替换变量集
- 暗色模式不是简单反转：背景层级用不同深度的灰（bg-page 最深，bg-card 稍浅，bg-hover 再浅），保持层次感
- 阴影在暗色模式下降低强度或改用边框分隔
- 图片和图表不做反色处理，但可降低亮度至 90% 避免刺眼
- Monaco Editor 主题同步切换（vs → vs-dark）
- 代码高亮配色方案同步切换

### 13.3 需要特别注意的场景

| 场景 | 处理方式 |
|------|----------|
| 状态标签 | 语义色在暗色模式下使用更亮的变体（第 3.1 节 Dark 列），背景用 10% 透明度 |
| 骨架屏 | 占位块颜色从浅灰改为深灰，动画保持 |
| 榜单高亮行 | 当前用户行底色从 primary/5% 调整为 primary/10%，确保在深色背景上可辨识 |
| Markdown 渲染 | 代码块背景色切换为 bg-code dark 值，引用块边框色跟随 border-default |
| 图形验证码 | 保持原样不做处理，验证码本身是服务端生成的图片 |

## 14. 出题系统前端

出题系统是题目管理的用户侧入口，普通用户通过此系统创建和管理自己的题目。

### 14.1 我的题目列表

```
┌─────────────────────────────────────────┐
│  我的题目                                │
│  [新建题目]                              │
├─────────────────────────────────────────┤
│  ID | 标题 | 状态 | 创建时间 | 操作       │
│  ─────────────────────────────────────  │
│  -  | A+B  | 草稿 | 1月15日 | 编辑/提审  │
│  -  | 最短路| 待审核| 1月14日 | 查看      │
│  1003| 背包 | 已发布| 1月10日 | 查看      │
├─────────────────────────────────────────┤
│  分页器                                  │
└─────────────────────────────────────────┘
```

- 普通用户只能看到自己创建的题目
- 状态标签颜色：草稿（info）、待审核（warning）、已发布（success）、已下架（text-disabled）
- 草稿状态可编辑和提交审核；待审核状态只能查看；已发布状态可查看
- ID 列：未分配显示 `-`，已发布显示分配的 display_id

### 14.2 题目编辑页（出题者视角）

与后台题目编辑页共用相同的表单结构（第 6.3 节），但有以下差异：

- 不可设置 display_id（由审核通过后管理员分配）
- 不可直接发布，只能保存草稿或提交审核
- 测试点管理区域：
  - 上传方式：拖拽上传 zip（自动解析 `*.in` / `*.out` 文件对）或逐个上传
  - 一键生成输出：上传标程代码 + 选择语言 → 点击"生成输出" → 显示进度（逐个测试点）→ 完成后列表刷新
  - 测试点列表：序号、输入文件名、输出文件名、大小、哈希（截断显示）、操作（下载/删除）
  - 可拖拽排序
- 验题功能：提交代码在当前题目上运行，结果显示在页面内（复用提交结果 UI）
- 底部操作栏：保存草稿 | 提交审核

### 14.3 审核反馈

- 审核通过：通知消息 + 题目状态变为"已发布" + 分配 display_id
- 审核驳回：通知消息包含驳回理由，题目状态回到"草稿"，用户可修改后重新提审

## 15. AI 辅助功能前端

### 15.1 Copilot 面板

在提交详情页和代码编辑器旁提供 AI 辅助入口。

```
┌──────────────────────────┬──────────────┐
│  代码编辑器 / 提交详情     │  Copilot 面板 │
│                          │  [CR] [分析]  │
│                          │  [补全] [解释] │
│                          │  ────────────│
│                          │  (SSE 流式输出)│
│                          │  AI 正在分析...│
│                          │  > 你的代码在  │
│                          │  > 第12行存在  │
│                          │  > 数组越界... │
│                          │              │
│                          │  剩余次数: 3/5 │
└──────────────────────────┴──────────────┘
```

功能按钮：
- Code Review：分析代码质量和潜在问题
- 复杂度分析：时间/空间复杂度评估
- 智能补全：根据上下文建议代码片段
- 错误分析：CE/RE 时自动分析编译器/运行时输出

交互规则：
- 点击功能按钮后，面板内以 SSE 流式逐字输出 AI 回复
- 输出过程中显示光标闪烁动画，完成后光标消失
- 输出内容支持 Markdown 渲染（代码块、列表等）
- 底部显示今日剩余使用次数（由 root 配置每日上限和模型权重）
- 次数用尽时按钮 disable，显示"今日额度已用完"
- AI 服务不可用时按钮 disable，显示"AI 服务暂不可用"

### 15.2 题目智能匹配

在题库页搜索框旁提供"智能搜索"切换：

- 普通搜索：标题关键词匹配
- 智能搜索：输入自然语言描述（如"求最短路径的题目"），调用向量数据库 embedding 匹配，返回相似度最高的若干题目
- 智能搜索结果额外显示相似度分数

### 15.3 出题辅助

在题目编辑页提供 AI 辅助按钮：
- 格式化题面：规范 Markdown 格式、统一术语
- 难度评估：根据题面和标程评估难度（标记为 AI 评分）
- 生成标签建议：根据题面内容推荐标签

## 16. 特殊场景处理

### 16.1 单例比赛模式

当 `system_config.singleton_contest_id` 指向一个进行中的比赛时：

- 首页重定向到比赛详情页
- 顶部导航栏精简为：比赛标题 | 题目 | 状态 | 榜单 | 通知 | 用户菜单
- 隐藏入口：公共题库、其他比赛、讨论区、排行榜、个人主页编辑
- 用户尝试访问被隐藏的路由时，显示"比赛进行中，该功能暂不可用"

### 16.2 比赛时间状态机

前端需要根据当前时间与比赛时间字段计算状态，并驱动 UI 变化：

```
未开始 ──(start_at)──→ 进行中 ──(freeze_at)──→ 封榜中 ──(end_at)──→ 已结束(封榜)
                                                                    ──(unfreeze_at)──→ 已结束(解榜)
```

| 状态 | 题目可见 | 可提交 | 榜单更新 | 倒计时显示 |
|------|----------|--------|----------|------------|
| 未开始 | 否 | 否 | - | 距开始 HH:MM:SS |
| 进行中 | 是 | 是 | 实时 | 距结束 HH:MM:SS |
| 封榜中 | 是 | 是 | 冻结 | 距结束 HH:MM:SS |
| 已结束(封榜) | 是 | 否 | 冻结 | 等待解榜 |
| 已结束(解榜) | 是 | 否 | 最终 | - |

倒计时实现：前端本地计时，每 5 分钟与服务端校准一次时间差，避免客户端时钟偏移。

### 16.3 大数据量表格

当数据量超过阈值时的处理策略：

| 场景 | 阈值 | 策略 |
|------|------|------|
| 榜单参赛者 | >200 行 | 虚拟滚动，只渲染可视区域 ±5 行缓冲 |
| 提交列表 | >10000 条 | 服务端分页，每页 50 条，禁止一次加载全部 |
| 测试点列表 | >100 个 | 分页或虚拟滚动 |
| 小组成员 | >500 人 | 服务端分页 + 搜索 |

### 16.4 文件上传

测试点上传、图片上传等场景的统一交互：

- 拖拽区域：虚线边框，拖入时边框变为 primary 色实线 + 背景变为 primary/5%
- 上传进度：文件名 + 进度条 + 百分比 + 取消按钮
- 上传成功：绿色对勾 + 文件信息
- 上传失败：红色叉号 + 错误原因 + 重试按钮
- 文件大小限制：超限时立即提示，不发起请求
- 多文件上传：逐个显示进度，支持批量取消

### 16.5 JS 精度处理

数据库使用 BIGINT 雪花 ID（64 位），JS Number 精度只有 53 位。

- 后端序列化时将所有雪花 ID 转为字符串
- 前端统一以字符串处理 ID，不做数值运算
- URL 路由参数中的 ID 保持字符串形式

## 17. 路由结构

### 17.1 前台路由

```
/                           首页
/login                      登录
/register                   注册

/problems                   题库列表
/problems/:problemId        题目详情（公共题库）

/problem-sets/:setId        题库详情
/problem-sets/:setId/:displayId  题库内题目详情

/contests                   比赛列表
/contests/:displayId        比赛详情（概览）
/contests/:displayId/problems           比赛题目列表
/contests/:displayId/problems/:displayId 比赛内题目详情
/contests/:displayId/status             比赛提交状态
/contests/:displayId/rank               比赛榜单
/contests/:displayId/announcements      比赛公告
/contests/:displayId/clarifications     比赛答疑

/status                     全局提交状态
/status/:submissionId       提交详情

/rank                       全局排行榜

/discussions                讨论列表
/discussions/:id            讨论详情

/announcements              公告列表
/announcements/:id          公告详情

/user/:username             用户主页
/settings                   个人设置
/notifications              通知列表

/my-problems                我的题目（出题）
/my-problems/new            新建题目
/my-problems/:id/edit       编辑题目

/help                       帮助文档
```

### 17.2 后台路由

```
/admin                      仪表盘
/admin/users                用户管理
/admin/users/:id            用户编辑
/admin/permission-groups    权限组管理

/admin/problems             题目管理
/admin/problems/:id/edit    题目编辑
/admin/problems/review      审核队列
/admin/tags                 标签管理

/admin/problem-sets         题库管理
/admin/problem-sets/:id     题库编辑

/admin/contests             比赛管理
/admin/contests/:id/edit    比赛编辑
/admin/contests/:id/manage  比赛管理面板

/admin/teams                小组管理
/admin/teams/:id            小组编辑

/admin/settings             系统设置
/admin/announcements        公告管理
/admin/notifications        通知中心
```

### 17.3 路由守卫

| 规则 | 行为 |
|------|------|
| 未登录访问需认证页面 | 重定向到 /login，登录后跳回原页面 |
| 非管理员访问 /admin | 重定向到 / 并显示"无权限"toast |
| 访问不存在的路由 | 显示 404 页面 |
| 单例比赛模式下访问被禁路由 | 显示"比赛进行中，该功能暂不可用" |
| 比赛未开始时访问题目 | 显示"比赛尚未开始" |
| 访问已软删除的资源 | 显示 404 |

## 18. 与后端接口的约定

### 18.1 通用响应格式

```json
{
  "code": 200,
  "message": "success",
  "data": { ... }
}
```

错误响应：

```json
{
  "code": 400,
  "message": "用户名已存在",
  "data": null
}
```

### 18.2 分页请求与响应

请求参数：`page`（从 1 开始）、`size`（每页条数，默认 20，最大 100）

响应 data：

```json
{
  "records": [ ... ],
  "total": 1234,
  "page": 1,
  "size": 20,
  "pages": 62
}
```

### 18.3 ID 传输

所有雪花 ID 在 JSON 中以字符串形式传输：

```json
{
  "id": "1234567890123456789",
  "userId": "9876543210987654321"
}
```

### 18.4 枚举传输

状态、类型等枚举字段以整数传输（与数据库一致），前端维护枚举映射表：

```json
{
  "status": 4,
  "language": 0,
  "mode": 0
}
```

前端枚举映射示例（伪代码）：

```
SUBMISSION_STATUS = {
  0: { label: "Pending", color: "info" },
  4: { label: "Accepted", color: "success" },
  6: { label: "Wrong Answer", color: "danger" },
  ...
}
```
